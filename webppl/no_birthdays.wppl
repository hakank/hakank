/*

  https://twitter.com/JohnAllenPaulos/status/1584278111579181056
  """
  Randomly select 365 people and mark their birthdays on a calendar. 
  Days on which none of the 365 people have a birthday will remain 
  unmarked. Let U be the number of such unmarked days. Then 365/U is 
  approximately the transcendentally ubiquitous number e, 2.718 â€¦ Eerie! 
  """

  Marginals:
  p
  Marginal:
    2.7238805970149254 : 0.06840000000000002
    2.744360902255639 : 0.06300000000000001
    2.7037037037037037 : 0.06239999999999999
    2.664233576642336 : 0.06160000000000001
    2.765151515151515 : 0.060600000000000015
    2.6838235294117645 : 0.0605
    2.786259541984733 : 0.05670000000000001
    2.6449275362318843 : 0.055
    2.6258992805755397 : 0.0529
    2.8076923076923075 : 0.05239999999999999
    2.8294573643410854 : 0.046700000000000005
    2.8515625 : 0.042700000000000016
    2.607142857142857 : 0.0416
    2.5886524822695036 : 0.035100000000000006
    2.874015748031496 : 0.033800000000000004
    2.5704225352112675 : 0.028800000000000006
    2.8968253968253967 : 0.028699999999999996
    2.5524475524475525 : 0.022199999999999998
    2.92 : 0.021100000000000004
    2.943548387096774 : 0.016199999999999992
    2.5347222222222223 : 0.0159
    2.967479674796748 : 0.014100000000000003
    2.5172413793103448 : 0.010599999999999998
    2.9918032786885247 : 0.008500000000000002
    2.5 : 0.008399999999999998
    2.4829931972789114 : 0.006200000000000001
    3.0165289256198347 : 0.0045
    2.4662162162162162 : 0.0045
    3.0416666666666665 : 0.0034000000000000007
    3.0672268907563027 : 0.002599999999999999
    2.4496644295302015 : 0.0025000000000000005
    2.433333333333333 : 0.0022000000000000006
    3.093220338983051 : 0.0014999999999999994
    3.1196581196581197 : 0.0011
    2.401315789473684 : 0.0008000000000000003
    2.4172185430463577 : 0.0005999999999999997
    3.1739130434782608 : 0.0004000000000000001
    3.2017543859649122 : 0.0004000000000000001
    3.2589285714285716 : 0.0003000000000000001
    3.146551724137931 : 0.0003000000000000001
    2.3856209150326797 : 0.0003000000000000001
    2.3701298701298703 : 0.00019999999999999985
    2.33974358974359 : 0.00010000000000000009
    2.28125 : 0.00010000000000000009
    2.2955974842767297 : 0.00010000000000000009

  expectation:
  [ [ 'p', 2.7278611020204657 ] ]

  MAP:
  [ [ 'p', { val: 2.7238805970149254, score: -2.682382454353632 } ] ]

  Credible interval for p (93%): [ 2.5172413793103448, 2.943548387096774 ]


  In Picat:
  Picat> N=100000,X=N/(N-[random(1,N):_ in 1..N].remove_dups.len)
  N = 100000
  X = 2.711790866688361

*/

// This is too complex and too slow
var model_slow = function() {

    var n = 100

    var x = mapN(function(i) {return randomInteger(n) },n)
    var t = mapN(function(i) {
        return sum(mapN(function(j) {
            return x[j] == i ? 1 : 0
        },n))
    },n)
    var s = sum(mapN(function(i) {
        return t[i] == 0 ? 1 : 0
    },n))
    var p = n/s
    
    return {
        // x:x,
        // t:t,
        s:s,
        p:p,
    }
}

// Much faster
var model = function() {
    var n = 365
    var p = n/(n - _.uniq(mapN(function(i) {return randomInteger(n) },n)).length)
    return {
        p:p,
    }
}

// var d = Infer({method:"rejection",samples:10000},model)
var d = Infer({method:"SMC",particles:10000},model)

exp_map_all(d)

console.log("\n")
showCredibleInterval(d,"p",0.93)
