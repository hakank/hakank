/*
  Test of Bernoulli

  expectation:
  [ [ 'prob', 0.3215497573239891 ],
    [ 'prior', 0.5010282242267048 ] ]

  MAP:
  [ [ 'prob', { val: 0.3020510813614975, score: -4.6356293934728 } ],
    [ 'prior',
      { val: 0.48595013935645104, score: -6.725433722188185 } ] ]


  See ~/blog/bernoulli_test.blog
*/


var model = function() {
    // Generated by R:
    // > rbinom(120,1,0.3)
    var ys1 = [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,
              1,0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,1,0,1,0,1,0,0,1,1,0,0,0,1,0,1,0,0,0,
              0,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,0,1,1,0,0,1,0,0,1,0,1,1,
              0,1,0,1,0,0,0,0,0,1,0,0];
    var ys = [false,false,true,false,false,false,false,false,false,false,true,false,false,
              false,false,true,false,false,false,false,true,false,false,false,false,false,
              false,false,true,true,false,true,true,false,true,false,true,false,false,false,
              false,true,false,false,false,true,false,true,false,false,false,false,false,true,
              true,false,true,false,true,false,false,true,true,false,false,false,true,false,
              true,false,false,false,false,false,true,false,false,true,false,true,false,
              false,false,false,false,false,false,false,false,true,false,true,true,false,
              false,true,false,true,true,false,false,true,false,false,true,false,true,true,
              false,true,false,true,false,false,false,false,false,true,false,false];
      
    var prob = beta(4,4);
    var prior = beta(4,4); // Prior, i.e. "plain" beta(4,4)
    
    var y = function(i) {
        return Bernoulli({p:prob});
    }

    // observe the values in y
    mapIndexed(function(i,val) {
        observe(y(i), val);
    }, ys);

    return {prob:prob,
            prior:prior};

}

// var d  = Infer(model);
var d  = Infer({method:"MCMC",kernel:"MH",samples:10000,burn:1000},model);
// display(d);


exp_map_all(d,["expectation","MAP"])
