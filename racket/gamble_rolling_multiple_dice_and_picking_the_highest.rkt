#| 

  Rolling multiple dice and picking the highest in Racket/Gamble 

  https://www.youtube.com/watch?v=X_DdGRjtwAo&t=157s
  The unexpected logic behind rolling multiple dice and picking the highest.

  Following Matt Parker's simulations.

  All the following calculations are exact

  * For two d20

Theoretical (2 dice): 553/40 (13.825)
variable : v
20: 39/400 (0.0975)
19: 37/400 (0.0925)
18: 7/80 (0.0875)
17: 33/400 (0.0825)
16: 31/400 (0.0775)
15: 29/400 (0.0725)
14: 27/400 (0.0675)
13: 1/16 (0.0625)
12: 23/400 (0.0575)
11: 21/400 (0.0525)
10: 19/400 (0.0475)
9: 17/400 (0.0425)
8: 3/80 (0.0375)
7: 13/400 (0.0325)
6: 11/400 (0.0275)
5: 9/400 (0.0225)
4: 7/400 (0.0175)
3: 1/80 (0.0125)
2: 3/400 (0.0075)
1: 1/400 (0.0025)
mean: 553/40 (13.825)

   (Matt Parker's first Python simulation gives 13.829135)

  * For two d12
Theoretical (2 dice): 611/72 (8.48611111111111)
variable : v
12: 23/144 (0.1597222222222222)
11: 7/48 (0.14583333333333334)
10: 19/144 (0.13194444444444445)
9: 17/144 (0.11805555555555555)
8: 5/48 (0.10416666666666667)
7: 13/144 (0.09027777777777778)
6: 11/144 (0.0763888888888889)
5: 1/16 (0.0625)
4: 7/144 (0.04861111111111111)
3: 5/144 (0.034722222222222224)
2: 1/48 (0.020833333333333332)
1: 1/144 (0.006944444444444444)
mean: 611/72 (8.48611111111111)

  * For two d6
Theoretical (2 dice): 161/36 (4.472222222222222)
variable : v
6: 11/36 (0.3055555555555556)
5: 1/4 (0.25)
4: 7/36 (0.19444444444444445)
3: 5/36 (0.1388888888888889)
2: 1/12 (0.08333333333333333)
1: 1/36 (0.027777777777777776)
mean: 161/36 (4.472222222222222)

  * For two d120
n:120 m:2
Theoretical (2 dice): 57959/720 (80.49861111111112)
variable : v
120: 239/14400 (0.01659722222222222)
119: 79/4800 (0.016458333333333332)
118: 47/2880 (0.016319444444444445)
117: 233/14400 (0.016180555555555556)
116: 77/4800 (0.016041666666666666)
115: 229/14400 (0.015902777777777776)
...
9: 17/14400 (0.0011805555555555556)
8: 1/960 (0.0010416666666666667)
7: 13/14400 (0.0009027777777777777)
6: 11/14400 (0.0007638888888888889)
5: 1/1600 (0.000625)
4: 7/14400 (0.0004861111111111111)
3: 1/2880 (0.00034722222222222224)
2: 1/4800 (0.00020833333333333335)
1: 1/14400 (6.944444444444444e-5)
mean: 57959/720 (80.49861111111112)

  @11:10 Parker shows that the formula for two dice is 
    1/(6*N)*(N+1)*(4*N-1)
  where N is the sides of the die.

Theoretical value for 2 dice:
n: 1 theoretical (2 dice): 1 (1.0)
n: 2 theoretical (2 dice): 7/4 (1.75)
n: 3 theoretical (2 dice): 22/9 (2.4444444444444446)
n: 4 theoretical (2 dice): 25/8 (3.125)
n: 5 theoretical (2 dice): 19/5 (3.8)
n: 6 theoretical (2 dice): 161/36 (4.472222222222222)
n: 7 theoretical (2 dice): 36/7 (5.142857142857143)
n: 8 theoretical (2 dice): 93/16 (5.8125)
n: 9 theoretical (2 dice): 175/27 (6.481481481481482)
n: 10 theoretical (2 dice): 143/20 (7.15)
n: 11 theoretical (2 dice): 86/11 (7.818181818181818)
n: 12 theoretical (2 dice): 611/72 (8.48611111111111)
n: 13 theoretical (2 dice): 119/13 (9.153846153846153)
n: 14 theoretical (2 dice): 275/28 (9.821428571428571)
n: 15 theoretical (2 dice): 472/45 (10.488888888888889)
n: 16 theoretical (2 dice): 357/32 (11.15625)
n: 17 theoretical (2 dice): 201/17 (11.823529411764707)
n: 18 theoretical (2 dice): 1349/108 (12.49074074074074)
n: 19 theoretical (2 dice): 250/19 (13.157894736842104)
n: 20 theoretical (2 dice): 553/40 (13.825)
n: 120 theoretical (2 dice): 57959/720 (80.49861111111112)


  * For 3 d6
variable : v
6: 91/216 (0.4212962962962963)
5: 61/216 (0.2824074074074074)
4: 37/216 (0.1712962962962963)
3: 19/216 (0.08796296296296297)
2: 7/216 (0.032407407407407406)
1: 1/216 (0.004629629629629629)
mean: 119/24 (4.958333333333333)

  * For 3 d12
variable : v
12: 397/1728 (0.22974537037037038)
11: 331/1728 (0.19155092592592593)
10: 271/1728 (0.1568287037037037)
9: 217/1728 (0.1255787037037037)
8: 169/1728 (0.09780092592592593)
7: 127/1728 (0.07349537037037036)
6: 91/1728 (0.052662037037037035)
5: 61/1728 (0.03530092592592592)
4: 37/1728 (0.02141203703703704)
3: 19/1728 (0.01099537037037037)
2: 7/1728 (0.004050925925925926)
1: 1/1728 (0.0005787037037037037)
mean: 455/48 (9.479166666666666)

  * For 3 d20
variable : v
20: 1141/8000 (0.142625)
19: 1027/8000 (0.128375)
18: 919/8000 (0.114875)
17: 817/8000 (0.102125)
16: 721/8000 (0.090125)
15: 631/8000 (0.078875)
14: 547/8000 (0.068375)
13: 469/8000 (0.058625)
12: 397/8000 (0.049625)
11: 331/8000 (0.041375)
10: 271/8000 (0.033875)
9: 217/8000 (0.027125)
8: 169/8000 (0.021125)
7: 127/8000 (0.015875)
6: 91/8000 (0.011375)
5: 61/8000 (0.007625)
4: 37/8000 (0.004625)
3: 19/8000 (0.002375)
2: 7/8000 (0.000875)
1: 1/8000 (0.000125)
mean: 1239/80 (15.4875)

  * For 3 d120
variable : v
120: 42841/1728000 (0.02479224537037037)
119: 42127/1728000 (0.024379050925925926)
118: 41419/1728000 (0.023969328703703704)
117: 40717/1728000 (0.023563078703703704)
116: 40021/1728000 (0.023160300925925924)
115: 39331/1728000 (0.02276099537037037)
114: 38647/1728000 (0.022365162037037038)
...
7: 127/1728000 (7.349537037037037e-5)
6: 91/1728000 (5.266203703703704e-5)
5: 61/1728000 (3.530092592592593e-5)
4: 37/1728000 (2.1412037037037036e-5)
3: 19/1728000 (1.099537037037037e-5)
2: 7/1728000 (4.050925925925926e-6)
1: 1/1728000 (5.787037037037037e-7)
mean: 43439/480 (90.49791666666667)


  This program was created by Hakan Kjellerstrand, hakank@gmail.com
  See also my Racket page: http://www.hakank.org/racket/

|#

#lang gamble

; (require gamble/viz)
(require racket)
(require "gamble_utils.rkt")
; (require "gamble_distributions.rkt")

(define (theoretical-2 n)
  (* (/ 1 (* 6 n)) (+ 1 n) (- (* 4 n) 1))
  )

; n: size of dice (d<n>)
; m: number of identical d<n> dice
(define (model solver n m)
  (displayln (format "n:~a m:~a" n m))
  (when (= m 2)
    (let ([t (theoretical-2 n)])
      (displayln (format "Theoretical (2 dice): ~a (~a)" t (* 1.0 t)))))
  
  (enumerate

   ; Throw m dice
   (define ts (for/list ([i m]) (add1 (random-integer n))))
    
   ; What is the max value?
   (define v (apply max ts))
    
   (list v)
   )
)

(for ([n '(20 12 6 120   6  12 20 120)]
      [m '( 2  2 2   2   3   3  3   3)])
  (show-marginals (model 'enumerate  n m)
                  (list  "v")))

(displayln "\nTheoretical value for 2 dice:")
(for ([n (append (range 1 21) (list 120))])
  (let ([t (theoretical-2 n)]) 
    (displayln (format "n: ~a theoretical (2 dice): ~a (~a)" n t (* 1.0 t) ))))
