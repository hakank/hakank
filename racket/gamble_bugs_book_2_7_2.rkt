#| 

  BUGS book, 2.7.2 in Racket Gamble.
  Example 2.7.2 Heart transplant cost-effectiveness (continued)
var : thetaN
2.0: 1.0000000000000007
mean: 2.0000000000000013
Min: 2.0 Mean: 2.0 Max: 2.0 Variance: 0.0 Stddev: 0.0
Credible interval (0.84): 2.0..2.0

var : thetaT
0.8881604546632641: 0.0009999999999999994
0.7578746622106486: 0.0009999999999999994
0.7105264678560695: 0.0009999999999999994
...
0.853306380887685: 0.0009999999999999994
0.7187971925083375: 0.0009999999999999994
0.9281017801182525: 0.0009999999999999994
mean: 0.8032452462852906
Min: 0.35355628113617754 Mean: 0.7979203354609735 Max: 0.9947998431889019 Variance: 0.013352898047699322 Stddev: 0.11555474048129451
Credible interval (0.84): 0.6719729102475008..0.9715209236419198

var : thetaP
6.780414440561833: 0.0009999999999999994
4.41992734973759: 0.0009999999999999994
4.906447071569104: 0.0009999999999999994
...
4.266336906655067: 0.0009999999999999994
4.473557665760114: 0.0009999999999999994
5.394965724991648: 0.0009999999999999994
mean: 5.0253875361215234
Min: 1.543940964271263 Mean: 5.091743399040525 Max: 8.139435407444557 Variance: 1.054394438320907 Stddev: 1.0268371040826811
Credible interval (0.84): 3.6796925276961217..6.5741945040919365

var : thetaC
2966.2863256248147: 0.0009999999999999994
3207.899270277481: 0.0009999999999999994
2716.6523449034803: 0.0009999999999999994
...
2496.1478005155823: 0.0009999999999999994
3121.4038399704227: 0.0009999999999999994
2705.765093711291: 0.0009999999999999994
mean: 3004.8849577332076
Min: 2003.1423620671285 Mean: 2999.230039939754 Max: 3871.024691357219 Variance: 96675.7822842233 Stddev: 310.92729420915
Credible interval (0.84): 2565.9402736374273..3430.4859931134115

var : E_c
35.13024457859632: 0.0009999999999999994
27.220677650448533: 0.0009999999999999994
34.349557744413914: 0.0009999999999999994
...
25.844729966451954: 0.0009999999999999994
30.538991822950134: 0.0009999999999999994
35.528344015934934: 0.0009999999999999994
mean: 32.15563980043837
Min: 23.744805317233467 Mean: 32.186473207939216 Max: 45.91145863343451 Variance: 10.971674908618672 Stddev: 3.312351869686956
Credible interval (0.84): 27.770089768093516..37.17844063343099

var : E_e
1.7643848536254283: 0.0009999999999999994
2.3082159327709757: 0.0009999999999999994
2.367822823475434: 0.0009999999999999994
...
3.035864275117751: 0.0009999999999999994
2.440732439253405: 0.0009999999999999994
0.6626604735142196: 0.0009999999999999994
mean: 2.040168202935021
Min: -0.6360458131078535 Mean: 2.0626588915688737 Max: 5.007528301389735 Variance: 1.0210247430857444 Stddev: 1.01045768990381
Credible interval (0.84): 0.6772235923251086..3.5537667847862915

var : ICER
15.42584430927856: 0.0009999999999999994
48.895149400088286: 0.0009999999999999994
27.207026775470467: 0.0009999999999999994
...
31.893272688403837: 0.0009999999999999994
13.2539480617565: 0.0009999999999999994
18.97804117957977: 0.0009999999999999994
mean: 48.87736147097932
Min: -8008.679033880493 Mean: 18.764948202542335 Max: 9447.958873606154 Variance: 178606.0237783258 Stddev: 422.61805898272473
Credible interval (0.84): 8.660280582965566..28.220220748415606

  This program was created by Hakan Kjellerstrand, hakank@gmail.com
  See also my Racket page: http://www.hakank.org/racket/

|#

#lang gamble

(require racket)
(require "gamble_utils.rkt")

(define (bugs-book-2-7-2)
  (; rejection-sampler
   importance-sampler
   ; mh-sampler

   (define thetaN 2.0)                             ;; expected lifetime without transplant
   (define thetaT (beta 8 2))                      ;; probability of surviving operation
   (define thetaP (normal 5 1))                    ;; expected survival post-transplant (mean 5, sd 1)
   (define thetaC (gaussian 3000.0 (sqrt 100000))) ;; expected cost per year (mean 3000, sd 1000)
   (define E_c    (/ (+ 20000.0 (* thetaC thetaT thetaP)) 1000.0)) ;; expected additional cost of transplant
   ;; in thousands of pounds
   (define E_e    (- (* thetaT thetaP) thetaN))    ;; expected total additional survival
   (define ICER   (/ E_c E_e))                     ;; incremental cost-effectiveness ratio
   
   (define (K i)
     (when (and (>= i 0) (<= i 20))
       (* ((- i 1) 5.0))))
   
    (define (INB i)
      (- (*  E_e (K i)) - E_c))
    
    (define (Q i)
      (> (INB i) 0))
    
    (list thetaN thetaT thetaP thetaC E_c E_e ICER)
   )
  )

(show-marginals (bugs-book-2-7-2)
                (list "thetaN" "thetaT" "thetaP" "thetaC" "E_c" "E_e" "ICER")
                #:truncate-output 3
                #:show-stats? #t
                #:credible-interval 0.84
                )

